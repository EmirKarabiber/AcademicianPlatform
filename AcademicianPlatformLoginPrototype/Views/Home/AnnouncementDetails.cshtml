@using AcademicianPlatform.Areas.Identity.Data
@using Microsoft.AspNetCore.Identity
@model AcademicianPlatform.Models.AnnouncementViewModel
@inject UserManager<ApplicationUser> UserManager
@inject IUserStore<ApplicationUser> UserStore
@inject SignInManager<ApplicationUser> SignInManager

@* bunlardan hangisi gerekli emin değilim o nedenle hepsini aldım *@



@{
	ViewBag.Title = "Mail Gönder";
}

@{
	var senderID = Model.AnnouncementSenderID;
	Console.WriteLine("AAAAAAAAAAsenderID: " + senderID);
	@*var user = await UserStore.FindByIdAsync(senderID, CancellationToken.None);*@
	var user = await UserManager.FindByIdAsync(Model.Announcement.AnnouncementSenderID);

	var AnnouncomentSenderID = Model.AnnouncementSenderID;
	var currentUser = await UserManager.GetUserAsync(User);
	var isCurrentUserAnnouncementCreator = currentUser.Id == senderID;
}

<div class="container mt-2">
	<div class="row d-flex justify-content-center">
		<div class="col-md-12">
			<div class="card p-3 py-4 border" id="cardd">
				<div class="text-center">
					<img src="@user.ProfilePhotoPath" style="width: 150px; height: auto;" class="rounded-circle">
				</div>
				<div class="text-center mt-3">
					<h5 class="mt-0 mb-2">@user.Title @user.FirstName @user.LastName</h5>
					<h6 class="mb-2"> @user.Department</h6>
				</div>
				<div class="px-4 mt-1">
					<div class="d-flex justify-content-between align-items-center">
						<span class="fonts mb-4">@Model.Announcement.AnnouncementTitle</span>
						<span class="mb-4" style="color: black; font-size: 14px;">
							@Model.Announcement.AnnouncementSentDate
						</span>
					</div>
					<p>
						@Model.Announcement.AnnouncementContent
					</p>
				</div>
				<div class="d-flex justify-content-center">
					<a class="buttonnn mt-4" asp-controller="Home" asp-action="EmailSender" asp-route-id="@Model.Announcement.ID">
						<svg>
							<rect x="0" y="0" fill="none" width="100%" height="100%" />
						</svg>
						Mail Gönder
					</a>
				</div>
				<div class="card-footer mt-4">
					<div class="d-flex justify-content-between align-items-center">
						<span>
							Telefon Numarası: @user.PhoneNumber
						</span>
						<a asp-action="AcademicianDetails" asp-route-id="@user.Id" class="btn btn-outline-danger">@user.FirstName @user.LastName Profili</a>
					</div>
				</div>

			</div>
		</div>
	</div>
</div>
<br />


<form asp-controller="Home" asp-action="AddComment" method="post">
	<input type="hidden" name="announcementID" value="@Model.Announcement.ID" />
	<div class="form-group">
		<label for="commentContent">Yorumunuzu Girin:</label>
		<textarea class="form-control" id="commentContent" name="commentContent" rows="3"></textarea>
	</div>
	<button type="submit" class="btn btn-primary">Yorum Ekle</button>
</form>

@if (Model.Announcement.Comments != null && Model.Announcement.Comments.Count > 0)
{
	<h4>Yorumlar</h4>
	<ul>
		@foreach (var comment in Model.Announcement.Comments)
{
    <li>
        <strong>@comment.User.Title @comment.User.FirstName @comment.User.LastName</strong>
        <span class="comment-date">@comment.DatePosted.ToString("dd/MM/yyyy HH:mm")</span>
        <p>@comment.Text</p>
        @if (User.Identity.Name == comment.User.UserName)
    {
        <form asp-controller="Home" asp-action="DeleteComment" method="post">
            <input type="hidden" name="commentID" value="@comment.Id" />
            <button type="submit" class="btn btn-sm btn-danger">Sil</button>
        </form>
    }
    </li>
}

	</ul>
}




@*  Eski sistem kodları (yedek olarak tutuluyor)

<!--<a class="btn btn-primary" onclick="sendEmail()">Mail Gönder</a>-->
        <!--  eski sistemin kodları  -->
<script>
    function sendEmail() {
        var recipientEmail = "@user.Email"; // Kullanıcının mail adresini alın
        var subject = "@Model.AnnouncementTitle Hk."; // Konu değerini istediğiniz şekilde belirleyin
        var body = "İçerik"; // İçerik değerini istediğiniz şekilde belirleyin

        var mailtoLink = "mailto:" + recipientEmail + "?subject=" + encodeURIComponent(subject) + "&body=" + encodeURIComponent(body);

        window.location.href = mailtoLink;
    }
</script>

<a asp-controller="Home" asp-action="EmailSender" asp-route-id="@Model.ID">Send Email</a>

        <a class="btn btn-danger" asp-controller="Home" asp-action="DeleteAnnouncement"
            asp-route-announcementID="@Model.ID">Delete</a>
*@
